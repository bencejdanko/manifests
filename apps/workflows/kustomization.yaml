apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Force everything (including patches) into this namespace
namespace: argo

resources:
  - install.yaml
  - sa-admin.yaml
  - crb-admin.yaml

# Use JSON6902 patches with explicit targets
patches:
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: argo-server
      namespace: argo
    patch: |-
      - op: add
        path: /spec/template/spec/containers/0/args/-
        value: --auth-mode=client
      # Optional: make HTTP for simplest LAN testing
      # - op: add
      #   path: /spec/template/spec/containers/0/args/-
      #   value: --secure=false

  # Optional: expose via NodePort (fixed 32746)
  # - target:
  #     version: v1
  #     kind: Service
  #     name: argo-server
  #     namespace: argo
  #   patch: |-
  #     - op: replace
  #       path: /spec/type
  #       value: NodePort
  #     - op: add
  #       path: /spec/ports/0/nodePort
  #       value: 32746
